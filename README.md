# Differential diagnosis of health control and schizophrenia using EEG biomarkers and graph neural network: A cross-site study
## Abstract
Routine and clinical electroencephalogram (EEG) has been used to monitor brain activity (e.g., seizure detection), but its application in assisting mental disorder diagnosis is still rare probably due to its low-density coverage and low signal to noise ratio. Taking differential diagnosis of health control (HC) and schizophrenia (SCZ) intelligently and objectively as an example, the real-world clinical application suffers from limited generalization capacity because of small sample size, population heterogeneity and feasibility. To address these challenges, we develop an advanced explainable deep learning model on a small dataset (N=188).  We extract multi-modal EEG features and demographic information for graph neural networks and propose different transfer learning strategies to accommodate flexible clinical scenarios, with augmentation from a large-scale public clinical EEG dataset (N=3,800). Cross-site validation on three independent datasets achieves promising performance, with AUC 0.793 – 0.852 and Accuracy 0.786 – 0.858 for different SCZ prevalence, demonstrating the high translational ability and clinical significance of our model.
## Dataset
In total, five EEG datasets were used in this study: 
1. the open-accessed TUH (USA) dataset only contained HCs and was used as an auxiliary resource for transfer learning; 
2. the Chengdu (China) dataset was used to build automatic diagnosis models；
3. cross-site tested on the Hangzhou (China) dataset with varying SCZ prevalence；
4. another open-accessed datasets, namely Moscow (Russia) were also used for cross-site performance validation. 

All samples were collected in eyes-closed resting state of participants using the standard 10-20 EEG montage. For simplicity, each dataset is referred to by their original locations.
## Feature extraction
16 common features are used in this study, including 14 temporal-domain features (e.g., power, energy, mean signal value) and 2 frequency-domain features (power spectral density-PSD, differential entropy-DE) from 16-channels (FP1, FP2, F3, F4, C3, C4, P3, P4, O1, O2, F7, F8, T3, T4, T5 and T6). In particular, we obtained frequency domain features from five different rhythms, including δ (1-4 Hz), θ (4-8 Hz), α (8-13 Hz), β (13-30 Hz), and γ (30-44 Hz). Furthermore, the age and gender of each subject are also considered as two demographic features.
## Framework
1. We build a [pre-trained model based on graph convolutional neural network](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/blob/main/tuh_pretrain.py) using TUH dataset, a large-scale public dataset. We have set two tasks in the pre-training model, which are the prediction of nodes and edges. 
2. During the transfer of the pre-trained model to other datasets in the downstream, we introduce [meta-learning](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/blob/main/meta_finetune.py) for the model to learn new tasks because all datasets used for pre-training are normal human samples. More specifically the new tasks we set are disease identity and domain classification. We randomly selected an equivalent amount of TUH data with Chengdu data together in the disease identity process for finetune of the pre-trained model. As the amount of data from HC sample and SCZ sample is unbalanced, we use infoNCE loss in contrast learning to increase the distance between different categories of samples and increase the accuracy of identification. The role of the discriminator is to promote more alignment of the margin distributions of the two datasets. 
3. With the strong generalization and discrimination ability after meta-finetuning, our model can be transferred to other datasets as a feature extractor. Incorporating domain discriminators and classifiers can improve the identifying accuracy of cross-datasets. 

In order to comprehensively validate the EEG-based diagnosis model for SCZ, [the Chengdu dataset was first used as the training and validation dataset](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/blob/main/intra_set.py). TUH was used as an auxiliary dataset to improve the model performance through transfer learning strategies of pre-training and meta-learning-based data augmentation. Next, the Hangzhou and Moscow datasets were used as [the cross-site test sets to evaluate](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/blob/main/inter_set.py) the classification performance externally. 

## Performance comparison 
Performance comparison between the proposed approach and [other deep learning algorithms](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/tree/main/DL_model) including EEGNet (a compact convolutional neural network), GAT (graph attention network), LSTM (long short-term memory recurrent neural network) and [traditional machine learning methods](https://github.com/ChenPeiyin/Diagnosis-based-EEG-A-cross-site-study/tree/main/ML_model) including SVM (Support Vector Machine), LR (Logistic regression), RF (Random Forest), and XGBoost (Extreme Gradient Boosting). 

